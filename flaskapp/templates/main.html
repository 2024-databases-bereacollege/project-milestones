<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link rel="stylesheet" href="../static/main.css">
</head>
<body>

<aside>
  <!-- Sidebar navigation -->
  <nav>
    <div class="admin-div">
      <p>Admin Panel</p>
      <img class="admin-pic" src="https://annemariesegal.com/wp-content/uploads/2017/04/adobestock_86346713-cropped-young-woman-in-suit.jpg?w=640">
    </div>
    <ul class="tables-div">
      <li><a href="main">Chapters</a></li>
      <li><a href="members">Members</a></li>
      <li><a href="donations">Donations</a></li>
      <li><a href="events">Events</a></li>
    </ul>
  </nav>
</aside>

<main>
  <!-- Main content section -->
  <header>
    <h1>Chapter Table</h1>
    <!-- Sorting Dropdown that submits on change -->
    <form action="/main" method="get">
      <h4>Sort by:</h4>   
        <select name="sort_by" onchange="this.form.submit()">
            <option value="chaptername-asc">Name Ascending</option>
            <option value="chaptername-desc">Name Descending</option>
            <option value="numberofmembers-asc">Members Ascending</option>
            <option value="numberofmembers-desc">Members Descending</option>
        </select>
    </form>
</header>






  <section>
    <!-- Table data -->
    <table class="table">
      <thead>
          <tr>
              <th>Chapter Name</th>
              <th>Number of Members</th>
              <th>Chapter Lead</th>
              <th>Chapter Email</th>
              <th>Action</th>
          </tr>
      </thead>
      <tbody>
          {% for chapter in chapters %}
          <tr>
              <td>{{ chapter.chaptername }}</td>
              <td>{{ chapter.numberofmembers }}</td>
              <td>{{ chapter.chapterlead }}</td>
              <td>{{ chapter.chapteremail }}</td>
              <td>
                <button onclick="openEditModal(this.getAttribute('data-chapter'))" data-chapter="{{ chapter|tojson|safe }}" class="btn btn-primary">Edit</button>
              </td>
          </tr>
          {% endfor %}
      </tbody>
  </table>
  
  <div id="editChapterModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <form id="editChapterForm" method="post" action="/update_chapter">
            <input type="hidden" id="edit_chapter_id" name="chapter_id">
            <label for="edit_chapter_name">Chapter Name:</label>
            <input type="text" id="edit_chapter_name" name="chapter_name" required><br>
            <label for="edit_number_of_members">Number of Members:</label>
            <input type="number" id="edit_number_of_members" name="number_of_members" required><br>
            <label for="edit_chapter_lead">Chapter Lead:</label>
            <input type="text" id="edit_chapter_lead" name="chapter_lead" required><br>
            <label for="edit_chapter_email">Chapter Email:</label>
            <input type="email" id="edit_chapter_email" name="chapter_email" required><br>
            <input type="submit" value="Update Chapter">
        </form>
    </div>
</div>

  
  </section>
</main>

<script>
  function sortTable() {
      var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
      table = document.getElementById("chapterTable");
      switching = true;
      // Determine sort direction from dropdown
      var sortOption = document.getElementById("sortOptions").value.split("-");
      var sortField = sortOption[0]; // 'name' or 'members'
      var sortOrder = sortOption[1]; // 'asc' or 'desc'
      while (switching) {
          switching = false;
          rows = table.getElementsByTagName("TR");
          for (i = 1; i < (rows.length - 1); i++) {
              shouldSwitch = false;
              x = rows[i].getElementsByTagName("TD")[sortField === 'name' ? 0 : 1];
              y = rows[i + 1].getElementsByTagName("TD")[sortField === 'name' ? 0 : 1];
              if (sortOrder === 'asc' && x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                  shouldSwitch = true;
              } else if (sortOrder === 'desc' && x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                  shouldSwitch = true;
              }
              if (shouldSwitch) {
                  rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                  switching = true;
                  break;
              }
          }
      }
  }

  function openEditModal(chapterData) {
    // Fill in the form fields with the data
    const chapter = JSON.parse(data);
    document.getElementById('edit_chapter_id').value = chapterData.chaptername; // Assuming chaptername is the ID, adjust if needed
    document.getElementById('edit_chapter_name').value = chapterData.chaptername;
    document.getElementById('edit_number_of_members').value = chapterData.numberofmembers;
    document.getElementById('edit_chapter_lead').value = chapterData.chapterlead;
    document.getElementById('edit_chapter_email').value = chapterData.chapteremail;

    // Display the modal
    document.getElementById('editChapterModal').style.display = 'block';
}

// Close modal function
function closeModal() {
    document.getElementById('editChapterModal').style.display = 'none';
}

// Enhance the window.onclick function to close modal when clicking outside of it
window.onclick = function(event) {
    var modal = document.getElementById('editChapterModal');
    if (event.target == modal) {
        closeModal();
    }
}



function closeModal() {
    document.getElementById('editChapterModal').style.display = 'none';
}

// Close the modal when clicking outside of it
window.onclick = function(event) {
    var modal = document.getElementById('editChapterModal');
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

  </script>
  

</body>
</html>
